<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Study Notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/study/logo.svg">
    <meta name="description" content="">
    
    <link rel="preload" href="/study/assets/css/0.styles.c052bd8b.css" as="style"><link rel="preload" href="/study/assets/js/app.89b49cc1.js" as="script"><link rel="preload" href="/study/assets/js/5.819200c8.js" as="script"><link rel="preload" href="/study/assets/js/8.05c74175.js" as="script"><link rel="prefetch" href="/study/assets/js/10.dbc5a249.js"><link rel="prefetch" href="/study/assets/js/11.85e5a543.js"><link rel="prefetch" href="/study/assets/js/12.e1291b1a.js"><link rel="prefetch" href="/study/assets/js/13.a3b9c001.js"><link rel="prefetch" href="/study/assets/js/14.e7710afb.js"><link rel="prefetch" href="/study/assets/js/15.78de5d79.js"><link rel="prefetch" href="/study/assets/js/16.82115cd2.js"><link rel="prefetch" href="/study/assets/js/17.d452a118.js"><link rel="prefetch" href="/study/assets/js/2.3522d1f3.js"><link rel="prefetch" href="/study/assets/js/3.59e5e7a5.js"><link rel="prefetch" href="/study/assets/js/4.60baceb2.js"><link rel="prefetch" href="/study/assets/js/6.31d99afa.js"><link rel="prefetch" href="/study/assets/js/7.49d348f4.js"><link rel="prefetch" href="/study/assets/js/9.d075a982.js">
    <link rel="stylesheet" href="/study/assets/css/0.styles.c052bd8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study/" class="home-link router-link-active"><img src="/study/logo.svg" alt="Study Notes" class="logo"> <span class="site-name can-hide">Study Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/study/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/study/spring/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/study/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/study/es/" class="nav-link">
  Elasticsearch
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow down"></span></button> <button type="button" aria-label="More" class="mobile-dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/study/mybatisplus/" class="nav-link">
  MybatisPlus
</a></li><li class="dropdown-item"><!----> <a href="/study/springcloudgateway/" class="nav-link">
  SpringCloudGateway
</a></li><li class="dropdown-item"><!----> <a href="/study/vue/" class="nav-link">
  Vue
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/study/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/study/spring/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/study/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/study/es/" class="nav-link">
  Elasticsearch
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow down"></span></button> <button type="button" aria-label="More" class="mobile-dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/study/mybatisplus/" class="nav-link">
  MybatisPlus
</a></li><li class="dropdown-item"><!----> <a href="/study/springcloudgateway/" class="nav-link">
  SpringCloudGateway
</a></li><li class="dropdown-item"><!----> <a href="/study/vue/" class="nav-link">
  Vue
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study/netty/#netty-介绍" class="sidebar-link">Netty 介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/netty/#netty-应用场景" class="sidebar-link">Netty 应用场景</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/netty/#i-o-模型" class="sidebar-link">I/O 模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/netty/#bio" class="sidebar-link">BIO</a></li><li class="sidebar-sub-header"><a href="/study/netty/#nio" class="sidebar-link">NIO</a></li><li class="sidebar-sub-header"><a href="/study/netty/#buffer-缓冲区" class="sidebar-link">Buffer（缓冲区）</a></li><li class="sidebar-sub-header"><a href="/study/netty/#channel-通道" class="sidebar-link">Channel（通道）</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>胡言乱语篇</p></blockquote> <h1 id="netty"><a href="#netty" class="header-anchor">#</a> Netty</h1> <h2 id="netty-介绍"><a href="#netty-介绍" class="header-anchor">#</a> Netty 介绍</h2> <blockquote><p>Netty 是一个异步事件驱动的网络应用程序 NIO 框架，用于快速开发可维护的高性能协议服务器和客户端，它极大地简化和精简了 TCP 和 UDP 套接字服务器等网络编程</p></blockquote> <h2 id="netty-应用场景"><a href="#netty-应用场景" class="header-anchor">#</a> Netty 应用场景</h2> <ul><li><p>互联网行业</p> <p>在分布式中，各个节点之间需要远程服务调用，高性能的 RPC 框架必不可少，Netty 作为异步高性能的通信框架，往往作为基础通信组件被这些 RPC 框架使用</p> <p>典型的应用有：阿里分布式服务框架 Dubbo 的 RPC 框架使用 Dubbo 协议进行节点间通信，Dubbo 协议默认使用 Netty 作为基础通信组件，用于实现各进程之间的内部通信</p></li> <li><p>大数据领域</p> <p>经典的 Hadoop 的高性能通信和序列化组件 Avro 的 RPC 框架，默认采用 Netty 进行跨界点通信</p> <p>它的 Netty Service 是基于 Netty 框架进行二次封装实现</p></li> <li><p>游戏行业</p> <p>Netty 作为高性能的基础通信组件，提供了 TCP/UDP 和 HTTP 协议栈，方便定制和开发私有协议栈，账号登录服务器等</p> <p>地图服务器之间可以方便的通过 Netty 进行高性能的通信</p></li></ul> <h2 id="i-o-模型"><a href="#i-o-模型" class="header-anchor">#</a> I/O 模型</h2> <blockquote><p>I/O模型就是用什么样的通道进行数据的发送和接收，很大程度上决定了程序通信的性能</p></blockquote> <p>Java支持3种网络编程模型：BIO、NIO、AIO</p> <p>Java BIO：<em>同步并阻塞</em>，服务器实现模式为一个连接一个线程，即客户端有连接请求时，服务器端就需要启动一个线程进行处理，如果这个线程不做任何操作就会造成不必要的线程开销，适用于<strong>连接数少且固定的架构</strong></p> <p>Java NIO：<em>同步非阻塞</em>，服务器实现模式为一个线程处理多个请求，即客户端发送的连接请求都会注册到多路复用器上，多路复用器轮询到连接有 I/O 请求就进行处理，适用于<strong>连接数目多且连接时间短的架构</strong>，如聊天服务器，弹幕系统等</p> <p>Java AIO：<em>异步非阻塞</em>，AIO 引入异步通道的概念，采用了 Proactor 模式，简化了程序的编写，有效的请求才会启动线程，它的特点是先由操作系统完成后才通知服务端启动线程去处理，一般适用于<strong>连接数多且连接时间长的应用</strong></p> <h3 id="bio"><a href="#bio" class="header-anchor">#</a> BIO</h3> <blockquote><p>Java BIO 就是传统的Java IO编程，其相关的类和接口在java.io</p> <p>BIO（blocking I/O）：同步阻塞，实现模式为一个连接一个线程，客户端有连接请求时服务器端就需要启动一个线程进行处理，如果这个连接不做任何处理操作会造成不必要的线程开销，可以通过线程池机制改善</p> <p>BIO 方式适用于连接数目比较小且固定的架构，对服务器资源要求比较高，并发局限于应用中，JDK1.4前唯一选择，程序简单易理解</p></blockquote> <blockquote><p>流程</p></blockquote> <ul><li>服务器端启动一个ServerSocket</li> <li>客户端启动Socket对服务器进行通信，默认情况下服务器端需要对客户端建立一个线程与之通讯</li> <li>客户端发出请求后，先咨询服务器是否有线程响应，如果没有则会等待，或者被拒绝</li> <li>如果有响应，客户端线程会等待请求结束后，再继续执行</li></ul> <blockquote><p>应用实例</p></blockquote> <p>新建maven项目、创建一个类，监听6666端口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it<span class="token punctuation">.</span>bio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">ServerSocket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author NAIHE
 * @projectName Netty01
 * @className BioServer
 * @date 2021-07-19
 * @week 周一
 * @time 上午 09:02
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;AlibabaThreadPoolCreation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BioServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">// 创建一个线程池</span>
        <span class="token class-name">ExecutorService</span> service <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">6666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;服务器启动了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果有客户端进行连接，就创建一个线程与之通讯</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 监听 等待客户端连接</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;等待连接....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;连接到一个客户端&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 创建线程</span>
            service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 客户端通讯方法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程信息 id = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;id = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// 通过socket获取输入流</span>
            <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 循环读取客户端发送数据</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;read....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> read <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;输出客户端发送的数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;关闭连接&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>启动测试</p></blockquote> <p>打开cmd，输入telnet IP/localhost 端口号，输入Ctrl + ]</p> <img src="data:image/png;base64,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mmNYExERaY4TzIiIiDTHljUREZHmGNZERESaY1gTERFpjmFNRESkOYY1ERGR5hjWREREmmNYExERaY5hTUREpDmGNRERkeYY1kRERJpjWBMREWmOYU1ERKQ5hjUREZHmGNZERESaY1gTERFpjmFNRESkOYY1ERGR5hjWREREmmNYExERaSDRtqcAAAEsSURBVI5hTUREpDmGNRERkeYY1kRERJpjWBMREWmOYU1ERKQ5hjUREZHmGNZERESaY1gTERFpjmFNRESkOYY1ERGR5hjWREREmmNYExERaY5hTUREpDmGNRERkeYY1kRERJpjWBMREWmOYU1ERKQ5hjUREZHmGNZERESaY1gTERFpjmFNRESkOYY1ERGR5hjWREREmmNYExERaY5hTUREpDmGNRERkeYY1kRERJpjWBMREWmOYU1ERKQ5hjUREZHmGNZERESaY1gTERFpjmFNRESkOYY1ERGR5hjWREREmmNYExERaY5hTUREpDmGNRERkeYY1kRERJpjWBMREWmOYU1ERKQ5hjUREZHmGNZERESaY1gTERFpjmFNRESkOYY1ERGR5hjWREREmvs/NCnRcgUuhsIAAAAASUVORK5CYII=" alt="image-20210719100830386" style="zoom:80%;"> <p><code>如果出现 telnet 不是内部命令或非可执行程序问题</code></p> <blockquote><p>打开 Windows 控制面板 &gt; 程序应用 &gt; 打开或关闭Windows应用 &gt; 勾选 telnet 客户端</p></blockquote> <div class="language-cmd extra-class"><pre class="language-text"><code>send hello
</code></pre></div><img src="/study/assets/img/image-20210719101220103.4b3d046e.png" alt="image-20210719101220103" style="zoom:80%;"> <blockquote><p>BIO 工作机制</p></blockquote> <img src="/study/assets/img/image-20210719102827554.efc88f53.png" alt="image-20210719102827554" style="zoom:80%;"> <h3 id="nio"><a href="#nio" class="header-anchor">#</a> NIO</h3> <blockquote><p>Java NIO 全称 Java non-blocking IO，是指 JDK 提供的新API，从JDK1.4开始，Java提供了一系列改进的输入/输出的新特性，被统称为 NIO，是同步非阻塞的</p> <p>NIO相关类都被放在 java.nio 包及子包下，并且对原 java.io 包中的很多类进行改写</p> <p>NIO有三大核心部分：<strong>Channel</strong>（通道），<strong>Buffer</strong>（缓冲区），<strong>Selector</strong>（选择器）</p> <p>NIO是<strong>面向缓冲区</strong>，或者<strong>面向块编程</strong>的，数据读到一个它稍后处理的缓冲区，需要时可在缓冲区中前后移动，这就增加了处理过程中的灵活性，使用它可以提供非阻塞式的高伸缩性网络</p> <p>Java NIO的非阻塞模式，使一个线程从某通道发送请求或者读取数据，但是它仅能得到目前的数据，如果目前没有数据可用时，就什么都不会获取，而不是<strong>保持线程阻塞</strong>，所以直至数据变成可读取之前，该线程可以继续做其他事，非阻塞写也是如此，一个线程请求写入一些数据到某通道，但不需要等待它完全写入，这个线程同时可以去做别的事情</p></blockquote> <img src="/study/assets/img/image-20210719111211228.ed251dcf.png" alt="image-20210719111211228" style="zoom:80%;"> <blockquote><p>NIO是可以做到用一个线程来处理多个操作的，假设现有10000个请求过来，根据实际情况可以分配50或100个线程来处理，不像之前的阻塞IO那样，必须分配10000个线程</p> <p>HTTP2.0使用了多路复用的技术，做到同一个连接并发处理多个请求，而且并发请求的数量比HTTP1.1大了好几个数量级</p></blockquote> <blockquote><p>Buffer 实例</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">IntBuffer</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author NAIHE
 * @projectName Netty01
 * @className BasicBuffer
 * @date 2021-07-19
 * @week 周一
 * @time 下午 12:19
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicBuffer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个buffer 大小为5 可以放5个int</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 向buffer存数据</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 读数据</span>
        <span class="token comment">// 将buffer转换，读写切换</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果向buffer存放的数据超过了它的大小，就会报<strong>缓冲区溢出异常</strong>错误</p> <div class="language-java extra-class"><pre class="language-java"><code>intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Exception</span> in thread <span class="token string">&quot;main&quot;</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span>BufferOverflowException</span>
</code></pre></div><blockquote><p>NIO 和 BIO 比较</p></blockquote> <ul><li>BIO 以流的方式处理数据，而 NIO 是以块的方式处理数据，块IO的效率比流IO高很多</li> <li>BIO 是阻塞的，NIO 是非阻塞的</li> <li>BIO 基于字节流和字符流进行操作，而 NIO 基于Channel（通道）和 Buffer（缓冲区）进行操作，数据总是从通道读取到缓冲区中，或者从缓冲区读到通道中，Selector（选择器）用于监听多个通道中的事件（比如：连接请求，数据到达等），因此使用<strong>单个线程就可以监听多个客户端</strong>通道</li></ul> <blockquote><p>NIO 三大核心原理</p></blockquote> <img src="/study/assets/img/image-20210719142020528.706f0524.png" alt="image-20210719142020528" style="zoom:80%;"> <ol><li>每个channel都会对应一个<strong>buffer</strong></li> <li>selector对应一个<strong>线程</strong>，一个线程对应多个channel（连接）</li> <li>该图反应有三个channel注册到selector/程序</li> <li>程序切换到哪个channel是由<strong>事件</strong>决定的，Event就是一个重要概念</li> <li>selector会根据不同的事件，在各个通道上切换</li> <li>buffer是一个内存块，底层是一个数组</li> <li>数据的读取写入是通过buffer和BIO，BIO中要么是输入流，要么是输出流，不能双向，但是NIO的Buffer是可以读也可以写的，需要 <strong>flip</strong> 方法切换</li> <li>channel是双向的，可以返回底层操作系统的情况，比如：Linux底层的操作系统通道就是双向的</li></ol> <h3 id="buffer-缓冲区"><a href="#buffer-缓冲区" class="header-anchor">#</a> Buffer（缓冲区）</h3> <p>缓冲区：本质上是一个可以读写数据的内存块，可以理解成是一个<strong>容器对象（含数组）</strong>，该对象提供了<strong>一组方法</strong>，可以更轻松使用内存块，缓冲区对象内置了一些机制，能够跟踪和记录缓冲区的状态变化情况，Channel提供从文件、网络读取数据的渠道，但是读取或写入的数据都必须经由Buffer</p> <img src="data:image/png;base64,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" alt="image-20210719144511359" style="zoom:80%;"> <blockquote><p>扩展</p></blockquote> <p>IntBuffer 是继承了一个 Buffer类</p> <img src="/study/assets/img/image-20210719144849731.6f92533e.png" alt="image-20210719144849731" style="zoom:67%;"> <p>Buffer是一个抽象类</p> <img src="/study/assets/img/image-20210719145009503.cadde8a1.png" alt="image-20210719145009503" style="zoom:67%;"> <div class="language-tex extra-class"><pre class="language-tex"><code>mark：标识
position：标识当前数组的索引
limit：表示对当前数组最大可以读取多少个或写入多少个
capacity：容量
</code></pre></div><blockquote><p>Buffer类及其子类</p></blockquote> <ul><li><p>在NIO中，Buffer是一个顶层父类，它是一个抽象类</p> <p><img src="/study/assets/img/image-20210719145935935.4d6ac676.png" alt="image-20210719145935935" style="zoom:80%;"> <img src="/study/assets/img/image-20210719150415328.903453eb.png" alt="image-20210719150415328" style="zoom:80%;"></p></li> <li><p>Buffer类定义了所有的缓冲区都具有的四个属性来提供关于其所包含的数据元素的信息</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Invariants</span><span class="token operator">:</span> mark <span class="token operator">&lt;=</span> position <span class="token operator">&lt;=</span> limit <span class="token operator">&lt;=</span> capacity

<span class="token keyword">private</span> <span class="token keyword">int</span> mark <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> limit<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> capacity<span class="token punctuation">;</span>
</code></pre></div><ul><li>Capacity：容量，即可容纳的最大数据量；在缓冲创建时被设定且不能改变</li> <li>Limit：表示缓冲区的当前终点，不能对缓冲区超过极限位置进行读写操作，极限是可以修改的</li> <li>Position：位置，下一个要被读或写的元素索引，每次读写缓冲区数据时都会改变值，为下次读写做准备</li> <li>Mark：标记</li></ul></li></ul> <p><img src="/study/assets/img/image-20210719151526327.75c40ad4.png" alt="image-20210719151526327" style="zoom:80%;"> <img src="/study/assets/img/image-20210719151554370.91147d19.png" alt="image-20210719151554370" style="zoom:80%;"></p> <p>每次读取position都会+1，当执行反转<strong>flip</strong>方法后，position又变成了0（起始位置）</p> <ul><li><p>Buffer类相关方法</p> <img src="/study/assets/img/image-20210719152506392.b527a0d4.png" alt="image-20210719152506392" style="zoom:80%;"></li> <li><p>ByteBuffer</p> <p>Java中基本数据类型（boolean除外），都有一个Buffer类型与之相对应，最常用的自然是ByteBuffer类（二进制数据）</p> <img src="/study/assets/img/image-20210719152829968.12e99d05.png" alt="image-20210719152829968" style="zoom:80%;"></li></ul> <h3 id="channel-通道"><a href="#channel-通道" class="header-anchor">#</a> Channel（通道）</h3> <ul><li><p>NIO的通道类似于流，但有区别</p> <ul><li>通道可以同时进行读写，而流只能读或写</li> <li>通道可以实现异步读写数据</li> <li>通道可以从缓冲读数据，也可以写数据到缓冲</li></ul></li> <li><p>BIO中的stream是单向的，例如：FileInputStream对象只能进行读取数据的操作，而NIO中的通道channel是双向的，可以读操作也可以写操作</p></li> <li><p>Channel在NIO中是一个接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Channel</span> <span class="token keyword">extends</span> <span class="token class-name">Closeable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div></li> <li><p>常用的channel类有：</p> <img src="/study/assets/img/image-20210719155234124.0583e226.png" alt="image-20210719155234124" style="zoom:80%;"></li> <li><p>FileChannel用于文件的数据读写，DatagramChannel用于UDP的数据读写，ServerSocketChannel和SocketChannel用于TCP的数据读写</p> <p>主要用来对本地文件进行IO操作，常见方法有：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 从通道读取数据并放到缓冲区</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> dst<span class="token punctuation">)</span>
<span class="token comment">// 把缓冲区的数据写到通道</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> src<span class="token punctuation">)</span>
<span class="token comment">// 从目标通道中复制数据到当前通道</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">long</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token class-name">ReadableByteChannel</span> src<span class="token punctuation">,</span><span class="token keyword">long</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">)</span>
<span class="token comment">// 把数据从当前通道复制给目标通道</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">long</span> <span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">long</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span><span class="token class-name">WritableByteChannel</span> target<span class="token punctuation">)</span>
</code></pre></div></li></ul> <blockquote><p>实例</p></blockquote> <p>将字符写入文件</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author NAIHE
 * @projectName Netty01
 * @className NioFileChannel
 * @date 2021-07-19
 * @week 周一
 * @time 下午 04:18
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioFileChannel</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello naihe&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建输出流</span>
        <span class="token class-name">FileOutputStream</span> fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;file01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过输出流获取对应channel</span>
        <span class="token class-name">FileChannel</span> fileChannel <span class="token operator">=</span> fileOutputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个缓冲区 bytebuffer</span>
        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将str放入buffer</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 把buffer中的数据写入channel</span>
        byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>文件读取</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author NAIHE
 * @projectName Netty01
 * @className NioFileChannel01
 * @date 2021-07-19
 * @week 周一
 * @time 下午 04:34
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioFileChannel01</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;file01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> fileChannel <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个缓冲区</span>
        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将通道数据读入buffer</span>
        fileChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 字节转字符创</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 关闭流</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>完成文件拷贝</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author NAIHE
 * @projectName Netty01
 * @className NioFileChannel02
 * @date 2021-07-19
 * @week 周一
 * @time 下午 04:44
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioFileChannel02</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;file01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建输入流对象</span>
        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取channel</span>
        <span class="token class-name">FileChannel</span> fileChannel1 <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 没有文件自动创建</span>
        <span class="token class-name">FileOutputStream</span> fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;file02.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> fileChannel2 <span class="token operator">=</span> fileOutputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 重置 清空buffer</span>
            byteBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果不加会循环读取0</span>
            <span class="token keyword">int</span> read <span class="token operator">=</span> fileChannel1<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 读完</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            byteBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 将buffer中的数据写入filechannel2</span>
            fileChannel2<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>it<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author NAIHE
 * @projectName Netty01
 * @className NioFileChannel03
 * @date 2021-07-30
 * @week 周五
 * @time 上午 08:58
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioFileChannel03</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">// 创建相关流</span>
        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;b.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取各个流对应的fileChannel</span>
        <span class="token class-name">FileChannel</span> inputStreamChannel <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> outputStreamChannel <span class="token operator">=</span> fileOutputStream<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用transferform完成拷贝</span>
        outputStreamChannel<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>inputStreamChannel<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>inputStreamChannel<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 关闭相关通道和流</span>
        inputStreamChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>关于Buffer和Channel的注意事项和细节</p></blockquote> <ul><li><p>ByteBuffer支持类型序列化的put和get，put放入什么类型数据，get就应该使用相应的数据类型来取出，否则可能有BufferUnderException异常</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioByteBufferPutGet</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//      创建一个buffer</span>
        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">putLong</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">putChar</span><span class="token punctuation">(</span><span class="token char">'奈'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">putShort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">getChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">getShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>可以将一个普通的Buffer转成只读的Buffer</p></li> <li><p>NIO还提供了MappedByteBuffer，可以让文件直接在内存中进行修改，而如何同步到文件由NIO来完成</p></li> <li><p>NIO还支持通过多个Buffer完成读写操作，Scattering和Gatering</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/study/assets/js/app.89b49cc1.js" defer></script><script src="/study/assets/js/5.819200c8.js" defer></script><script src="/study/assets/js/8.05c74175.js" defer></script>
  </body>
</html>
