<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM的位置 | Study Notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/study/logo.svg">
    <meta name="description" content="">
    
    <link rel="preload" href="/study/assets/css/0.styles.7d302c8d.css" as="style"><link rel="preload" href="/study/assets/js/app.6d3630f5.js" as="script"><link rel="preload" href="/study/assets/js/2.40365491.js" as="script"><link rel="preload" href="/study/assets/js/1.eec64618.js" as="script"><link rel="preload" href="/study/assets/js/14.eb7a6da8.js" as="script"><link rel="prefetch" href="/study/assets/js/10.bfd158aa.js"><link rel="prefetch" href="/study/assets/js/11.ee769b27.js"><link rel="prefetch" href="/study/assets/js/12.c5502306.js"><link rel="prefetch" href="/study/assets/js/13.772ba8b8.js"><link rel="prefetch" href="/study/assets/js/15.04415536.js"><link rel="prefetch" href="/study/assets/js/16.b81b8892.js"><link rel="prefetch" href="/study/assets/js/17.faf137c3.js"><link rel="prefetch" href="/study/assets/js/18.ba9636f0.js"><link rel="prefetch" href="/study/assets/js/19.2a36490d.js"><link rel="prefetch" href="/study/assets/js/20.cb0fe819.js"><link rel="prefetch" href="/study/assets/js/21.fdfe156a.js"><link rel="prefetch" href="/study/assets/js/22.aaf6fed9.js"><link rel="prefetch" href="/study/assets/js/23.fc8322ab.js"><link rel="prefetch" href="/study/assets/js/24.bfc40fb7.js"><link rel="prefetch" href="/study/assets/js/25.688b920d.js"><link rel="prefetch" href="/study/assets/js/26.9b302a72.js"><link rel="prefetch" href="/study/assets/js/27.0ba8ed8f.js"><link rel="prefetch" href="/study/assets/js/28.48655c0b.js"><link rel="prefetch" href="/study/assets/js/29.6726a437.js"><link rel="prefetch" href="/study/assets/js/3.e37420f1.js"><link rel="prefetch" href="/study/assets/js/30.185b360a.js"><link rel="prefetch" href="/study/assets/js/31.dfbef273.js"><link rel="prefetch" href="/study/assets/js/32.1382e380.js"><link rel="prefetch" href="/study/assets/js/33.5e7d748d.js"><link rel="prefetch" href="/study/assets/js/34.fde6461c.js"><link rel="prefetch" href="/study/assets/js/35.ca6fc384.js"><link rel="prefetch" href="/study/assets/js/36.29151333.js"><link rel="prefetch" href="/study/assets/js/37.6504d9c5.js"><link rel="prefetch" href="/study/assets/js/4.26fde88e.js"><link rel="prefetch" href="/study/assets/js/5.5e14a162.js"><link rel="prefetch" href="/study/assets/js/6.a5c47722.js"><link rel="prefetch" href="/study/assets/js/7.d769642e.js"><link rel="prefetch" href="/study/assets/js/vendors~docsearch.ca4cd80d.js">
    <link rel="stylesheet" href="/study/assets/css/0.styles.7d302c8d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study/" class="home-link router-link-active"><img src="/study/logo.svg" alt="Study Notes" class="logo"> <span class="site-name can-hide">Study Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/study/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/study/spring/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/study/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/study/es/" class="nav-link">
  Elasticsearch
</a></div><div class="nav-item"><a href="/study/docker/" class="nav-link">
  Docker
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow down"></span></button> <button type="button" aria-label="More" class="mobile-dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/study/mybatisplus/" class="nav-link">
  MybatisPlus
</a></li><li class="dropdown-item"><!----> <a href="/study/springcloudgateway/" class="nav-link">
  SpringCloudGateway
</a></li><li class="dropdown-item"><!----> <a href="/study/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/study/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/study/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/study/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/study/jvm/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Jvm
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/study/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/study/spring/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/study/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/study/es/" class="nav-link">
  Elasticsearch
</a></div><div class="nav-item"><a href="/study/docker/" class="nav-link">
  Docker
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="More" class="dropdown-title"><span class="title">More</span> <span class="arrow down"></span></button> <button type="button" aria-label="More" class="mobile-dropdown-title"><span class="title">More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/study/mybatisplus/" class="nav-link">
  MybatisPlus
</a></li><li class="dropdown-item"><!----> <a href="/study/springcloudgateway/" class="nav-link">
  SpringCloudGateway
</a></li><li class="dropdown-item"><!----> <a href="/study/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/study/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/study/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/study/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/study/jvm/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Jvm
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JVM的位置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study/jvm/#这种机制有什么优点呢" class="sidebar-link">这种机制有什么优点呢?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#沙箱机制" class="sidebar-link">沙箱机制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#组成沙箱的基本组件" class="sidebar-link">组成沙箱的基本组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#栈内存溢出" class="sidebar-link">栈内存溢出?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#栈帧的结构" class="sidebar-link">栈帧的结构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#垃圾回收" class="sidebar-link">垃圾回收</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#oom" class="sidebar-link">OOM</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#新生区" class="sidebar-link">新生区</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/jvm/#伊甸园区" class="sidebar-link">伊甸园区</a></li><li class="sidebar-sub-header"><a href="/study/jvm/#幸存区-survive" class="sidebar-link">幸存区(survive)</a></li></ul></li><li><a href="/study/jvm/#老年区" class="sidebar-link">老年区</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#永久区" class="sidebar-link">永久区</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#复制算法" class="sidebar-link">复制算法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#标记清除" class="sidebar-link">标记清除</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#标记压缩" class="sidebar-link">标记压缩</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#jmm" class="sidebar-link">JMM</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study/jvm/#三大特性" class="sidebar-link">三大特性</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jvm的位置"><a href="#jvm的位置" class="header-anchor">#</a> JVM的位置</h1> <img src="/study/assets/img/image-20230714185129350.c231b2dc.png" alt="image-20230714185129350" style="zoom:80%;"> <h1 id="体系结构"><a href="#体系结构" class="header-anchor">#</a> 体系结构</h1> <img src="/study/assets/img/image-20230714191031704.ab5f471d.png" alt="image-20230714191031704" style="zoom:80%;"> <h1 id="类加载器"><a href="#类加载器" class="header-anchor">#</a> 类加载器</h1> <blockquote><p>加载class文件</p></blockquote> <p>类是抽象的 一个模板 而实例对象是具体的</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userClass <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

        <span class="token class-name">User</span> u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> u1Class <span class="token operator">=</span> u1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> u2Class <span class="token operator">=</span> u2<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u1Class <span class="token operator">==</span> u2Class<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u1<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u2<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> u1Class <span class="token operator">=</span> u1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> u2Class <span class="token operator">=</span> u2<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u1Class<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u2Class<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>运行结果</p></blockquote> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code>1468177767
434091818
1531333864
1531333864

进程已结束,退出代码0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/study/assets/img/image-20230714193410636.f3f392d8.png" alt="image-20230714193410636"></p> <hr> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> u1Class <span class="token operator">=</span> u1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> u1Class<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// AppClassLoader</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// PlatformClassLoader</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-tex line-numbers-mode"><pre class="language-tex"><code>1468177767
434091818
1531333864
1531333864
jdk.internal.loader.ClassLoaders<span class="token equation string">$AppClassLoader@2437c6dc
jdk.internal.loader.ClassLoaders$</span>PlatformClassLoader@17c68925

进程已结束,退出代码0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/study/assets/img/image-20230714194216790.45eaeb6d.png" alt="image-20230714194216790"></p> <hr> <blockquote><p>Java8的根包是java.rt</p> <p>Java11的根包是java.base</p></blockquote> <p><img src="/study/assets/img/image-20230714194922271.338c171b.png" alt="image-20230714194922271"></p> <h1 id="类加载器-2"><a href="#类加载器-2" class="header-anchor">#</a> 类加载器</h1> <blockquote><p>Java8及以前的版本有三种类加载器</p></blockquote> <ul><li>BootstrapClassLoader: 启动类加载器
<ul><li>该加载器使用C++实现 没有继承ClassLoader</li></ul></li> <li>ExtensionClasssLoader: 扩展类加载器
<ul><li>加载ext目录下的类库</li> <li>在1.9之后 被**PlatformClassLoader(平台类加载器)**所替代</li></ul></li> <li>ApplicationClassLoader: 应用类加载器
<ul><li>一般加载用户类路径上所有类库</li> <li>如果没有自定义类加载器 该类加载器就是默认类加载器</li></ul></li></ul> <h1 id="双亲委派机制"><a href="#双亲委派机制" class="header-anchor">#</a> 双亲委派机制</h1> <blockquote><p>为了保障安全而存在</p></blockquote> <p>类加载器收到加载类的请求后, 不会自己去加载, 而是将这个请求向上委托给父加载器, 直到启动类加载器</p> <p>如果启动类加载器无法处理则抛出异常并<strong>通知子类加载</strong> 否则直接加载当前类</p> <p>若都找不到 抛出<code>ClassNotFoundException</code></p> <img src="/study/assets/img/image-20230714203301801.7285bd94.png" alt="image-20230714203301801" style="zoom:80%;"> <h2 id="这种机制有什么优点呢"><a href="#这种机制有什么优点呢" class="header-anchor">#</a> 这种机制有什么优点呢?</h2> <blockquote><p>避免了类的重复加载</p> <p>保护系统程序的安全 防止核心API被修改</p></blockquote> <h1 id="沙箱安全机制"><a href="#沙箱安全机制" class="header-anchor">#</a> 沙箱安全机制</h1> <blockquote><p>沙箱是为了限制应用运行的环境</p> <p>也是限制应用能够访问的系统资源</p></blockquote> <p>JDK1.0的安全模型将代码分为本地代码和远程代码, 本地代码默认可信任, 远程代码默认不可信任, 受信任的代码可以访问本地的所有资源</p> <img src="/study/assets/img/image-20230715010343684.439011f3.png" alt="image-20230715010343684" style="zoom:80%;"> <blockquote><p>但是, 这种模型对程序的扩展非常不友好</p></blockquote> <hr> <p>JDK1.1安全模型对安全机制有了改进, 添加了<strong>安全策略</strong>, 可以设定代码对本地资源的访问权限</p> <hr> <p>JDK1.2安全模型增加了代码签名, 本地代码和远程代码都通过类加载器将类加载到不同的权限命名空间, 实现权限控制</p> <hr> <p>JDK1.6引入了域「domain」的概念, 虚拟机会把所有代码加载到不同的域(系统域、应用域)中</p> <p>系统域负责关键资源的交互, 而应用域通过代理访问需要的资源</p> <p>不同的域对应不同的权限</p> <img src="/study/assets/img/image-20230715004659908.38e8d58a.png" alt="image-20230715004659908" style="zoom:80%;"> <h2 id="沙箱机制"><a href="#沙箱机制" class="header-anchor">#</a> 沙箱机制</h2> <blockquote><p>将Java代码限定在JVM规定的运行范围中, 并严格限制代码对本地资源的访问, 以此来保证对代码的有效隔离, 防止对本地资源的污染</p></blockquote> <h2 id="组成沙箱的基本组件"><a href="#组成沙箱的基本组件" class="header-anchor">#</a> 组成沙箱的基本组件</h2> <ul><li>字节码校验器
<ul><li>确保class文件遵循Java规范, 对Java程序的内存进行保护</li> <li>当然, 不是所有的字节码文件都会进行校验, 比如: 核心类的字节码文件(.class)</li></ul></li> <li>类加载器
<ul><li>防止恶意代码污染程序</li> <li>将代码归入不同受保护域, 限制代码的权限</li></ul></li> <li>存取控制器
<ul><li>控制API对操作系统的存取权限</li></ul></li> <li>安全管理器
<ul><li>核心API和操作系统间的主要接口, 实现权限控制, 优先级要高于存取控制器</li></ul></li> <li>API</li></ul> <h1 id="本地方法栈"><a href="#本地方法栈" class="header-anchor">#</a> 本地方法栈</h1> <blockquote><p>由native修饰的方法, 都是调了C的方法</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">java<span class="token punctuation">.</span>lang</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>由native修饰的方法调用后 最终会进入本地方法栈</p> <h1 id="本地方法接口"><a href="#本地方法接口" class="header-anchor">#</a> 本地方法接口</h1> <blockquote><p>与Java之外的环境进行交互</p> <p>与操作系统进行交互</p></blockquote> <p>JVM一部分是用C写的, Java程序中像<strong>Thread</strong>、<strong>Robot</strong>等底层都是调用的native方法</p> <h1 id="程序计数器"><a href="#程序计数器" class="header-anchor">#</a> 程序计数器</h1> <blockquote><p>为了保证程序能够一直连续执行下去</p> <p>在程序运行开始前, 将程序的第一条指令所在的内存单元输送进PC, 当执行指令时, CPU自动修改PC的内容, 每执行一条指令PC增加一个量, 这个量等于指令所包含的字节数, 使其保持总要执行下一条指令的地址</p></blockquote> <ul><li>占用内存空间小, 可以忽略不计, 也是运行速度最快的存储区域, 不会随程序的运行而扩大空间</li> <li>JVM规范中, 每个线程都有其对应的计数器, 并且是线程私有的</li></ul> <blockquote><p>面试题</p></blockquote> <p><strong>JVM计数器如何进行计数?</strong></p> <p>==存储要执行的下一条指令的字节码地址==</p> <h1 id="方法区"><a href="#方法区" class="header-anchor">#</a> 方法区</h1> <blockquote><p>被所有线程共享</p></blockquote> <blockquote><p>保存的是类的信息(属性、成员变量、构造函数等)、静态变量、常量</p> <p><code>创建的对象是保存在堆当中</code></p></blockquote> <img src="/study/assets/img/image-20230715132241044.696bcefe.png" alt="image-20230715132241044" style="zoom:80%;"> <p>使用<code>new String()</code>创建的字符串不是常量, 不能在编译期就确定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;Naihe&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;Naihe&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;Naihe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;Naihe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;xy&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;x&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>引用的变量在编译期也是无法确定的</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;xy&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str3 <span class="token operator">=</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;x&quot;</span> <span class="token operator">+</span> str3<span class="token punctuation">;</span>
        <span class="token comment">// &quot;x&quot; + str3无法被编译器优化, 只有在程序运行时来动态分配并将连接后的新地址分配给str3</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>final修饰的变量, 在编译期被解析为常量值的一个本地拷贝存储在自己的常量池中</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;xy&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 和上一个例子不同: 有final修饰</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> str3 <span class="token operator">=</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;x&quot;</span> <span class="token operator">+</span> str3<span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h1 id="栈"><a href="#栈" class="header-anchor">#</a> 栈</h1> <blockquote><p>保存的都是堆数据的引用</p> <p>每个栈中的数据都是私有的, 其他栈无法访问</p> <p>栈中放的都是八大基本数据类型、对象的引用、实例的方法</p></blockquote> <p><strong>栈里面的数据都是先进后出的</strong></p> <blockquote><p>面试题</p></blockquote> <p><strong>栈和堆的区别?哪一个更有效率?</strong></p> <p>==栈不存在GC, 栈比堆的执行效率要高, 栈的内存比较小, 数据结构就是栈结构, 堆内存比较大, 存储多种数据结构, 栈管运行, 堆管存储==</p> <h2 id="栈内存溢出"><a href="#栈内存溢出" class="header-anchor">#</a> 栈内存溢出?</h2> <p>“<code>StackOverflowError</code>”</p> <img src="/study/assets/img/image-20230715135231987.7ec54fbf.png" alt="image-20230715135231987" style="zoom:80%;"> <blockquote><p>栈的单位就是栈帧, 栈帧的数据都是以栈帧的格式存在的</p> <p>线程上执行的每一个方法都对应一个栈帧</p></blockquote> <h2 id="栈帧的结构"><a href="#栈帧的结构" class="header-anchor">#</a> 栈帧的结构</h2> <img src="/study/assets/img/image-20230715142058707.5a7213d2.png" alt="image-20230715142058707" style="zoom:80%;"> <h2 id="垃圾回收"><a href="#垃圾回收" class="header-anchor">#</a> 垃圾回收</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 两种方式</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="三大虚拟机"><a href="#三大虚拟机" class="header-anchor">#</a> 三大虚拟机</h1> <ul><li>Hotspot</li> <li>JRockit</li> <li>J9</li></ul> <blockquote><p>如何查看JVM版本?</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-version</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><img src="/study/assets/img/image-20230715170343216.a963255c.png" alt="image-20230715170343216" style="zoom:80%;"> <h1 id="堆"><a href="#堆" class="header-anchor">#</a> 堆</h1> <p>Heap&lt;hi:p&gt;</p> <blockquote><p>一个JVM只有一个Heap内存, 并且是线程共享的, 堆的内存大小是可调节的, 这就是JVM调优</p></blockquote> <p>类加载器加载类文件后, 会把类的信息放入Heap中: 方法、常量、变量</p> <p>堆内存有三个区域</p> <ul><li>新生区</li> <li>老年区</li> <li>永久区/元数据</li></ul> <img src="/study/assets/img/image-20230715173157587.720eda7a.png" alt="image-20230715173157587" style="zoom:80%;"> <h2 id="oom"><a href="#oom" class="header-anchor">#</a> OOM</h2> <blockquote><p>堆内存溢出</p></blockquote> <p><code>OutOfMemoryError: Overflow: String length out of range</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;Naihe&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            str <span class="token operator">+=</span> str <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">999999999</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">999999999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="新生区"><a href="#新生区" class="header-anchor">#</a> 新生区</h2> <blockquote><p>类诞生和死亡的地方</p></blockquote> <p>存储在JVM中的对象可以分为两类</p> <ul><li>生命周期短的对象, 这类对象的创建和销毁都很快</li> <li>老不死的, 某些情况下甚至能和JVM的生命周期保持一样</li></ul> <h3 id="伊甸园区"><a href="#伊甸园区" class="header-anchor">#</a> 伊甸园区</h3> <blockquote><p>基本上Java的所有对象都是在这里new出来的</p></blockquote> <h3 id="幸存区-survive"><a href="#幸存区-survive" class="header-anchor">#</a> 幸存区(survive)</h3> <blockquote><p>经过第一次清理后, eden中的数据会被放到幸存区</p></blockquote> <blockquote><p>面试题</p></blockquote> <p><strong>对象内存分配过程</strong></p> <p>==new的对象先放入eden区, 当eden区满时会进行GC, 然后将剩余的数据放入幸存区, 然后幸存区的对象再进行GC, 在0区和1区来回切换, 直到经历(-XX:MaxTenuringThreshold)设定的值次后, 进入养老区==</p> <p>==养老区内存不足时, 执行GC进行清理, 当执行GC后依然无法存储对象就会产生OOM异常==</p> <p><strong>内存分配原则</strong></p> <p>==优先分配到eden区, 长期存活的对象分配到老年区==</p> <p><strong>GC垃圾回收</strong></p> <ul><li>Minor GC: 对新生区进行回收</li> <li>Major GC: 对老年区进行回收</li> <li>Mixed GC: 对新生区和部分老年区进行回收</li> <li>Full GC: 对整个堆和方法区进行回收</li></ul> <p><strong>垃圾回收触发机制</strong></p> <img src="/study/assets/img/image-20230715180445230.bf2bb28e.png" alt="image-20230715180445230" style="zoom:80%;"> <h2 id="老年区"><a href="#老年区" class="header-anchor">#</a> 老年区</h2> <blockquote><p>通常情况下, 新创建的对象都会分配到新生区, 除了一些大对象会分配到老年区</p> <p>经历<code>-XX:MaxTenuringThreshold</code>次<strong>Minor GC</strong>后, 也会进入老年区</p></blockquote> <h2 id="永久区"><a href="#永久区" class="header-anchor">#</a> 永久区</h2> <blockquote><p>存放一些类的信息, 常量池, 静态变量等</p></blockquote> <img src="/study/assets/img/image-20230724155124799.499e81d5.png" alt="image-20230724155124799" style="zoom:80%;"> <blockquote><p>永久区等同于方法区, 但方法区不等同于永久区</p> <p>方法区是概念上的东西, 永久区是对方法区的一个实现, jdk1.8之后替换为元空间, 和之前的不同 元空间存在本地内存中, 永久区在虚拟机中</p></blockquote> <img src="/study/assets/img/image-20230715181735951.b75d0980.png" alt="image-20230715181735951" style="zoom:80%;"> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 虚拟机尝试使用的最大内存</span>
        <span class="token keyword">var</span> max <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 虚拟机中的内存总量</span>
        <span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 虚拟机空闲内存量</span>
        <span class="token keyword">var</span> free <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> maxStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%dbyte, %dKB, %dMB&quot;</span><span class="token punctuation">,</span> max<span class="token punctuation">,</span> max <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">,</span> max <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>maxStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> totalStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%dbyte, %dKB, %dMB&quot;</span><span class="token punctuation">,</span> total<span class="token punctuation">,</span> total <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">,</span> total <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>totalStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> freeStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%dbyte, %dKB, %dMB&quot;</span><span class="token punctuation">,</span> free<span class="token punctuation">,</span> free <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">,</span> free <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>freeStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="/study/assets/img/image-20230721153041753.df831012.png" alt="image-20230721153041753"></p> <blockquote><p>修改分配内存大小并打印虚拟机内存信息</p></blockquote> <ul><li><p>jdk8</p> <p><code>-Xms1024m -Xmx1024m -XX:+PrintGCDetails</code></p></li> <li><p>jdk11</p> <p><code>-Xms1024m -Xmx1024m -Xlog:gc*</code></p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>-Xms: 初始化内存大小
-Xmx: 最大可分配内存
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><img src="/study/assets/img/image-20230721183001406.13a29498.png" alt="image-20230721183001406" style="zoom:80%;"> <img src="/study/assets/img/image-20230721183025202.4d3956c5.png" alt="image-20230721183025202" style="zoom:80%;"> <h1 id="oom问题排查"><a href="#oom问题排查" class="header-anchor">#</a> OOM问题排查</h1> <p><a href="https://www.ej-technologies.com/download/jprofiler/files" target="_blank" rel="noopener noreferrer">JProfiler工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>==JProfiler可以和IDEA集成, 在IDEA中下载jprofiler插件并配置JProfiler执行路径==</p> <img src="data:image/png;base64,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" alt="image-20230724150641382" style="zoom:80%;"> <blockquote><p>可以使用JProfiler分析dump文件, 得知程序出问题的点</p></blockquote> <img src="/study/assets/img/image-20230724144442425.89729ab9.png" alt="image-20230724144442425" style="zoom:80%;"> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token parameter variable">-Xms1m</span> <span class="token parameter variable">-Xmx8m</span> <span class="token parameter variable">-XX:+HeapDumpOnOutOfMemoryError</span>
<span class="token comment"># OutOfMemoryError监视的异常错误</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">App</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Exception是无法捕捉到该异常的</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><img src="/study/assets/img/image-20230724144534401.de2c9049.png" alt="image-20230724144534401" style="zoom:80%;"> <p><strong>使用JProfiler打开生成的dump文件</strong></p> <img src="/study/assets/img/image-20230724150848142.d00c5208.png" alt="image-20230724150848142" style="zoom:80%;"> <img src="/study/assets/img/image-20230724150933303.85048bb4.png" alt="image-20230724150933303" style="zoom:80%;"> <img src="/study/assets/img/image-20230724151102056.3e1a01d5.png" alt="image-20230724151102056" style="zoom:80%;"> <h1 id="gc"><a href="#gc" class="header-anchor">#</a> GC</h1> <blockquote><p>JVM在GC时, 通常都是对新生代进行回收</p></blockquote> <p><strong>GC有两种类型</strong></p> <ul><li><p>轻GC</p> <p>主要对新生区和老年区进行回收</p></li> <li><p>重GC</p> <p>主要对整个堆和方法区进行回收</p></li></ul> <blockquote><p>面试题</p></blockquote> <p><strong>JVM内存模型和分区, 每个区存放的内容?</strong></p> <p>==JVM内存模型有方法区、堆、栈、本地方法栈、程序计数器==</p> <p>==区分为伊甸园区、新生区、幸存区、老年区、永久区==</p> <p>==伊甸园区存放类相关信息==</p> <p>==老年区存放生命周期较长的类==</p> <p>==永久区存放静态方法、类等==</p> <p>==方法区: 线程共享, 存放类信息、常量池等==</p> <p>==堆: 线程共享, 存放实例对象、成员变量等==</p> <p>==栈: 存放堆内存的引用地址, 由栈帧组成, 每调用一个方法就往栈中压入一个栈帧==</p> <p>==本地方法栈: 存放native方法服务==</p> <p>==程序计数器: 存放线程下一个执行的字节码地址==</p> <p><strong>堆的分区并说说它们的特点</strong></p> <p>==堆分为新生区, 伊甸园区, 幸存区(from, to), 老年区==</p> <p>==新生区存放一些生命周期较短的类, 类的诞生和死亡都在此==</p> <p>==from和to: 经过GC回收后, 会将幸存的对象移到to里面, 和from是动态交换的==</p> <p>to里面永远是空的?(不太清楚)</p> <p>==老年区存放一些生命周期较长类, 从新生区淘汰下来的类也会存放在此==</p> <p><strong>GC的算法</strong></p> <p>==复制算法、标记清除、标记压缩==</p> <blockquote><p>没有最优的算法, 只有最合适的算法</p> <p>年轻代相对老年代来说, 对象存活率较低, 适用复制算法, 速度快, 效率高</p> <p>老年代区域较大, 对象存活率较高, 采用标记清除和标记压缩混合实现</p></blockquote> <p><strong>轻GC和重GC分别在什么时候发生?</strong></p> <p>==轻GC一般在新生区和老年区发生, 当新生区空间满了的时候会发生轻GC==</p> <p>==重GC是对整个堆和方法区进行回收, 当老年代满了的时候会触发重GC==</p> <h2 id="复制算法"><a href="#复制算法" class="header-anchor">#</a> 复制算法</h2> <img src="/study/assets/img/image-20230729162805834.2dc9d036.png" alt="image-20230729162805834" style="zoom:80%;"> <blockquote><p>当from区堆满时 GC将from区的活动对象复制到to区 然后form和to区互换 from空间的大小和to区的大小必须一致 保证to区能收纳form区的所有对象</p> <p>==这个过程经历15次后 会将对象转移到老年区==</p> <p><code>-XX:MaxTenuringThreshold</code>: 该参数可以改变对象进入老年区的时间</p></blockquote> <img src="/study/assets/img/image-20230729163938227.477c6f88.png" alt="image-20230729163938227" style="zoom:80%;"> <p><strong>优点</strong></p> <ul><li>不会产生内存碎片</li></ul> <p><strong>缺点</strong></p> <ul><li>浪费了to区的空间</li> <li>当对象100%存活的时候 需要将所有的对象都复制一遍 非常耗费时间</li></ul> <h2 id="标记清除"><a href="#标记清除" class="header-anchor">#</a> 标记清除</h2> <blockquote><p>标记要回收的对象 然后统一回收</p> <p>所以它会有两项工作 标记和清除</p> <p>遍历整个堆 把所有标记的对象清除</p></blockquote> <img src="/study/assets/img/image-20230729165554738.9064a1eb.png" alt="image-20230729165554738" style="zoom:80%;"> <p><strong>缺点</strong></p> <ul><li>效率低</li> <li>内存空间零散</li></ul> <h2 id="标记压缩"><a href="#标记压缩" class="header-anchor">#</a> 标记压缩</h2> <blockquote><p>和标记清除一样 对标记的对象进行回收 然后按照内存地址依次排列</p></blockquote> <img src="/study/assets/img/image-20230729165758948.bb931b21.png" alt="image-20230729165758948" style="zoom:80%;"> <p><strong>优点</strong></p> <ul><li>堆空间浪费少</li> <li>内存利用率高</li></ul> <p><strong>缺点</strong></p> <ul><li>效率不高, 不仅要标记并清除对象, 还要整理存活对象</li></ul> <p><strong>三大算法优劣比较</strong></p> <p>内存效率上: 复制算法 &gt; 标记清除 &gt; 标记压缩</p> <p>内存整齐度: 复制算法 = 标记压缩 &gt; 标记清除</p> <p>内存利用率: 标记压缩 = 标记清除 &gt; 复制算法</p> <hr> <h1 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h1> <h2 id="jmm"><a href="#jmm" class="header-anchor">#</a> JMM</h2> <blockquote><p>Java内存模型 全称: <strong>Java Memory Model</strong></p></blockquote> <p><strong>它是一种抽象概念, 描述了一种规则或规范, 定义了程序对内存的访问方式, 而JVM需要遵循这种规范</strong></p> <h2 id="三大特性"><a href="#三大特性" class="header-anchor">#</a> 三大特性</h2> <ul><li><p>原子性</p> <p>一个或多个操作, 要么全执行, 要么全不执行</p></li> <li><p>可见性</p> <p>只要有一个线程修改了共享变量, 其他线程马上收到通知, 获取最新值</p></li> <li><p>有序性</p> <p>在本线程内观察, 所有操作都是有序的</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/study/assets/js/app.6d3630f5.js" defer></script><script src="/study/assets/js/2.40365491.js" defer></script><script src="/study/assets/js/1.eec64618.js" defer></script><script src="/study/assets/js/14.eb7a6da8.js" defer></script>
  </body>
</html>
